function laybind(selector,options){var self=this;self.data={};self.bind_els=[];var bind_data={};self.bind_twoway={};self.startTwoway=function(list){_forEach_twoway(list,function(d){if(!d.listener){d.el.addEventListener("change",function(e){if(e.target.twoway){self.data[e.target.laybind_attr]=e.target[_get_el_tag(e.target)]}});d.listener=true}d.el.twoway=true})};self.stopTwoway=function(list){_forEach_twoway(list,function(d){d.el.twoway=false})};self.refresh=function(newData,init){if(init!==false){[].forEach.call(self.bind_els,function(e){e[_get_el_tag(e)]=""})}newData=typeof newData==="object"?newData:bind_data;for(var attr in newData){self.data[attr]=newData[attr]}};self.getData=function(){return bind_data};self.setData=function(newData){self.refresh(newData)};var els=selector instanceof jQuery?selector:$(selector);if(els.size()){self.bind_els=els.find("[laybind]").each(function(i,e){var attr=e.getAttribute("laybind");var tpl=e.getAttribute("laybind-tpl");if(tpl){tpl=tpl.charAt(0)==="#"?$(tpl).html():tpl}else{tpl=e[_get_el_tag(e)]}e.laybind_attr=attr;e.laybind_tpl=tpl;if(_get_el_tag(e)!=="innerHTML"&&attr&&e.getAttribute("laybind-oneway")===null){self.bind_twoway[attr]={el:e,listener:false}}if(attr&&options.data[attr]===undefined){options.data[attr]=""}});self.startTwoway();if(self.bind_els.length){_bind(options.data,self.data)}}self.refresh(options.data);function _bind(data,self_data){for(var attr in data){(function(attr,bind_data,self_data){Object.defineProperty(self_data,attr,{set:function(value){bind_data[attr]=value;if(self.laytplShow!==false){_show(attr,value,bind_data)}},get:function(){return bind_data[attr]}})})(attr,bind_data,self_data)}}function _show(attr,value,data){[].forEach.call(self.bind_els,function(e){if(e.laybind_attr){if(e.laybind_attr==attr){if(!e.laybind_tpl){e[_get_el_tag(e)]=value}else{e[_get_el_tag(e)]=laytpl(e.laybind_tpl).render(data[attr])}}}else{if(e.laybind_tpl){e[_get_el_tag(e)]=laytpl(e.laybind_tpl).render(data)}}})}function _forEach_twoway(list,callBack){if(!list){list=[];for(var attr in self.bind_twoway){list.push(attr)}}else{if(typeof list==="string"){list=[list]}}if(list instanceof Array){list.forEach(function(attr){if(self.bind_twoway[attr]!==undefined){callBack(self.bind_twoway[attr])}})}}function _get_el_tag(e){return["INPUT","TEXTAREA"].indexOf(e.tagName)>-1?(["checkbox","radio"].indexOf(e.type)>-1?"checked":"value"):"innerHTML"}Object.defineProperty(self,"laytplShow",{set:function(value){self._laytplShow=value;if(value===true){self.refresh()}},get:function(){return self._laytplShow}})};